'use strict';

import React from 'react';
import { renderToString } from 'react-dom/server';

import {{ name }} from './{{ fileName }}.view';
import {{ name }}Model from './{{ fileName }}.model';
import renderLayout from '../layout';

export default {
  get: get
}

function get(req, res) {
  let {{ varName }} = new {{ name }}Model(req.params.location)

  {{ varName }}.get().then(page => {
    const initialState = {};

    const appString = renderToString(<{{ name }} {...initialState} />);

    res.send(renderLayout({
        body: appString,
        title: 'Web Development',
        assetKey: '{{ fileName }}.js', // this is the key from js-manifest.json (generated by build)
        initialState: JSON.stringify(initialState)
      }))

  })
  .catch(err => {
    console.error(err);
    res.status(400).send('ERROR: ' + err);
  });
}
